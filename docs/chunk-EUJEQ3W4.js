import{D as u,g as s,h as o,k as i,la as l,m as n,p as c,s as m,ua as p}from"./chunk-HTQQWDB6.js";var g=class a{constructor(e){this.router=e;this.loadUserFromStorage()}currentUserSignal=u(null);currentUser=l(()=>this.currentUserSignal());isAuthenticated=l(()=>this.currentUserSignal()!==null);mockUsers=new Map([["demo@docroster.com",{password:"password123",user:{id:"1",email:"demo@docroster.com",name:"Demo User",avatar:"https://i.pravatar.cc/150?img=1",role:"user",createdAt:new Date("2024-01-01")}}],["specialist@docroster.com",{password:"specialist123",user:{id:"2",email:"specialist@docroster.com",name:"Dr. Jane Smith",avatar:"https://i.pravatar.cc/150?img=5",role:"specialist",createdAt:new Date("2024-01-01")}}]]);login(e){return s(null).pipe(i(500),o(()=>{let r=this.mockUsers.get(e.email);if(r&&r.password===e.password)return{user:r.user,token:this.generateMockToken()};if(this.isValidEmail(e.email)&&e.password.length>=6)return{user:{id:Date.now().toString(),email:e.email,name:this.extractNameFromEmail(e.email),avatar:`https://i.pravatar.cc/150?u=${e.email}`,role:"user",createdAt:new Date},token:this.generateMockToken()};throw new Error("Invalid email or password")}),n(r=>{this.setCurrentUser(r.user,r.token)}))}register(e){return s(null).pipe(i(500),o(()=>{if(this.mockUsers.has(e.email))throw new Error("User already exists");if(!this.isValidEmail(e.email))throw new Error("Invalid email format");if(e.password.length<6)throw new Error("Password must be at least 6 characters");return{user:{id:Date.now().toString(),email:e.email,name:e.name,avatar:`https://i.pravatar.cc/150?u=${e.email}`,role:"user",createdAt:new Date},token:this.generateMockToken()}}),n(r=>{this.setCurrentUser(r.user,r.token)}))}logout(){this.currentUserSignal.set(null),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),this.router.navigate(["/auth/login"])}getCurrentUser(){return this.currentUserSignal()}isLoggedIn(){return this.currentUserSignal()!==null}setCurrentUser(e,r){this.currentUserSignal.set(e),localStorage.setItem("currentUser",JSON.stringify(e)),localStorage.setItem("authToken",r)}loadUserFromStorage(){let e=localStorage.getItem("currentUser"),r=localStorage.getItem("authToken");if(e&&r)try{let t=JSON.parse(e);this.currentUserSignal.set(t)}catch(t){console.error("Failed to parse stored user:",t),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken")}}generateMockToken(){return"mock_token_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}extractNameFromEmail(e){return e.split("@")[0].split(/[._-]/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}static \u0275fac=function(r){return new(r||a)(m(p))};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
